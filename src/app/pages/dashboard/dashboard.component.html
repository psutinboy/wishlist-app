<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <h1>My Wishlists</h1>
      <div class="header-actions">
        <span class="user-info">{{ currentUser()?.displayName }}</span>
        <a routerLink="/settings" class="btn btn-secondary">Settings</a>
        <button (click)="logout()" class="btn btn-secondary">Logout</button>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    @if (isLoading() && lists().length === 0) {
      <div class="loading">Loading your wishlists...</div>
    }

    @if (error()) {
      <div class="error-message">
        {{ error() }}
        <button (click)="loadLists()" class="btn btn-secondary btn-sm">Retry</button>
      </div>
    }

    @if (!isLoading() && lists().length === 0) {
      <div class="empty-state">
        <h2>No wishlists yet</h2>
        <p>Create your first wishlist to get started!</p>
        <button (click)="openCreateModal()" class="btn btn-primary">Create Wishlist</button>
      </div>
    }

    @if (lists().length > 0) {
      <div class="lists-header">
        <h2>Your Lists</h2>
        <button (click)="openCreateModal()" class="btn btn-primary">New List</button>
      </div>

      <div class="lists-grid">
        @for (list of lists(); track list.id) {
          <div class="list-card">
            <a [routerLink]="['/list', list.id]" class="list-card-link">
              <div class="list-card-header">
                <h3>{{ list.title }}</h3>
                <span [class]="'badge ' + (list.isPublic ? 'badge-public' : 'badge-private')">
                  {{ list.isPublic ? 'Public' : 'Private' }}
                </span>
              </div>
              <div class="list-card-meta">
                <span class="meta-item">Share ID: {{ list.shareId }}</span>
              </div>
            </a>
            <div class="list-card-actions">
              <button (click)="copyShareUrl(list, $event)" class="btn-link">Copy Link</button>
              <button (click)="deleteList(list, $event)" class="btn-link danger">Delete</button>
            </div>
          </div>
        }
      </div>
    }
  </main>
</div>

@if (showCreateModal()) {
  <div class="modal-overlay" (click)="closeCreateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Create New Wishlist</h2>
        <button (click)="closeCreateModal()" class="btn-close">&times;</button>
      </div>
      
      <form [formGroup]="createListForm" (ngSubmit)="createList()">
        <div class="form-group">
          <label for="title">List Title</label>
          <input
            id="title"
            type="text"
            formControlName="title"
            placeholder="e.g., Birthday 2024"
            [class.error]="createListForm.controls.title.invalid && createListForm.controls.title.touched"
          />
          @if (createListForm.controls.title.invalid && createListForm.controls.title.touched) {
            <span class="field-error">Title is required (max 200 characters)</span>
          }
        </div>

        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" formControlName="isPublic" />
            <span>Make this list public (anyone with the link can view)</span>
          </label>
        </div>

        <div class="modal-actions">
          <button type="button" (click)="closeCreateModal()" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="createListForm.invalid || isCreating()">
            @if (isCreating()) {
              <span>Creating...</span>
            } @else {
              <span>Create List</span>
            }
          </button>
        </div>
      </form>
    </div>
  </div>
}

